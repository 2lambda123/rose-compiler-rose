This directory contains C++ files generated by Rosebud et al.
=============================================================

The plan is to eventually cause these files to be regenerated
automatically by all of ROSE's supported build tools. But for now, we
generate them by running Rosebud manually and placing the results in
ROSE's source tree, and checking them into the Git repository. See
below for details.

Locations of files
------------------

The inputs for these files are in the ROSE source tree in the
src/AstNodes/BinaryAnalysis directory. Each header file therein
contains the definition for exactly one ROSE IR node.

The source code for the `rosebud` tool is located in the ROSE source
tree in the src/Rosebud directory. All supported build systems
understand how to build it.

Regenerating generated files by hand
------------------------------------

To regenerate generated source files:

1. Build the `rosebud` tool. It's probably already built since all
   ROSE's build systems understand how to do so. If not, go to the
   src/Rosebud directory and build it with `make rosebud` or
   similar. Its only dependencies are Boost and Sawyer, the latter of
   which is distributed with ROSE and built automatically.
   
2. See documentation with `rosebud --help`.

3. Generate the files. I'm assuming you're in src/Rosebud in the build
   tree, but that's not strictly necessary as long as you adjust the
   command appropriately.

```
   ./rosebud --backend=rosetta \
       --rosetta=$ROSE_SOURCE/src/ROSETTA/src/binaryInstruction.C \
       --impl=$ROSE_SOURCE/src/generated \
       --node-list=$ROSE_SOURCE/src/ROSETTA/astNodeList \
       $ROSE_SOURCE/src/AstNodes/BinaryAnalysis/*.h
```

   Note that the `--node-list` switch can add new node types to the
   specified file, but cannot delete node types that are no longer
   generated. If you remove a node definition, you'll need to remove
   it from the astNodeList file manually.

Writing your own generators
---------------------------

Rosebud is intended to be modular and it's possible to write your own
backends. The `rosebud --backend=yaml ...` command will generate a
machine readable YAML description of the inputs. ROSE has a built-in
YAML library (`Rose::Yaml`) if you want to write your backend in C++,
but nearly every language has a [YAML parser](https://yaml.org). If it
doesn't, a translation from YAML to JSON (and other formats) is
straightforward and JSON is even more
[widely supported](https://www.json.org/json-en.html).  Backend code
generators can also be linked into the `rosebud` tool and use its IR
directly.

Here's a shell script that will create a forward declaration for every
ROSE IR node type. It reads YAML from standard input and generates
forward declarations on standard output. For the 20k lines of YAML
currently produced (2023-03-31), it can generate the declarations in a
fraction of a second.

```
#/bin/bash
yq '[.classes.[].name]' |sed 's/^- /class /; s/$/;/'
```

For more information, see the Rosebud API in src/Rosebud.
